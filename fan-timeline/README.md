# Sports Fan Thread → Timeline + Sentiment

Turn chaotic live Reddit NBA game threads into a **clean, minute-by-minute fan timeline** with sentiment and top themes. This repo ships a full pipeline:

- **Teacher pipeline** to synthesize SFT data (no manual labels)
- **QLoRA SFT** script (Llama-3.1-8B / Qwen2-7B)
- **Schema validator & guardrails** to enforce strict JSON
- **FastAPI serve** + **Streamlit demo**
- **Synthetic data generator** so the demo runs out-of-the-box

## Quickstart

```bash
# 1) Create and activate a venv
python3 -m venv .venv && source .venv/bin/activate

# 2) Install deps
pip install --upgrade pip
pip install -r requirements.txt

# 3) Make sure Python can import src/
export PYTHONPATH=$(pwd)

# 4) Generate a synthetic sample game (no internet)
python src/timeline/make_synth.py --out data/sample

# 5) Build teacher outputs & SFT pairs
python src/timeline/teacher.py --reddit data/sample/reddit/2019-12-01-LAL-DAL.jsonl \
  --pbp data/sample/pbp/2019-12-01-LAL-DAL.json \
  --out data/sample/teacher

python src/timeline/make_sft.py --windows data/sample/teacher/windows.jsonl \
  --out data/sft/sft_data.jsonl

# 6) (Optional) Train with QLoRA (requires GPU; otherwise skip)
# Edit configs/nba.yaml if needed
python src/timeline/train_sft.py --config configs/nba.yaml

# 7) Run the Streamlit demo
streamlit run app/streamlit_app.py

# 8) Or run the API server
uvicorn src.timeline.serve:app --reload --port 8000
```

### Minimal hardware

- CPU runs for teacher & demo; training recommended on a modest GPU (8–24GB). Mac CPU fine for demo (model fallback uses teacher summarizer).

### Data folders

```
data/
  reddit/        # your Reddit game threads (jsonl per game)
  pbp/           # play-by-play json per game
  sft/           # synthesized SFT pairs
  sample/        # synthetic example generated by make_synth.py
```

### What to replace when using real data

- Put your Reddit threads into `data/reddit/` as `.jsonl` (one JSON object per comment with `body`, `created_utc`, `score`, `author`)
- Put your play-by-play into `data/pbp/` as `.json` (list of events with `period`, `clock`, `type`, `team`, `points`, `desc`)
- Adjust `configs/nba.yaml` thresholds & paths
